#!/usr/bin/env bash

set -e

export PATH=/home/vcap/app/bin:$PATH

_start_command com.rabbitmq.perf.PerfTest \
  --uris "$(_amqp_urls)" \
  --multiAckEvery "${MULTI_ACK_EVERY:?must be set}" \
  --size "${MSG_SIZE:?must be set}" \
  --interval "${METRICS_SAMPLING_INTEVAL:?must be set}" \
  --qos "${QOS:?must be set}" \
  --queue "${QUEUE:?must be set}" \
  --consumers "${CONSUMERS:?must be set}" \
  --producers "${PRODUCERS:?must be set}" \
  --routingKey "${ROUTING_KEY:?must be set}" \
  --autoDelete "${AUTO_DELETE:=true}" \
  --queueArgs "$QUEUE_ARGS" \
  --predeclared
